!function(){"use strict";function e(e,t=null){const n=(new Date).toISOString();t?console.log(`[TweetGuard CS ${n}] ${e}`,t):console.log(`[TweetGuard CS ${n}] ${e}`)}const t=new Set;let n=!1;const i={human:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',ai:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></svg>',uncertain:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',lock:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>',loading:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',error:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'};function r(e,t){if(e.querySelector(".ai-detector-badge"))return;const n=function(e){const t=Math.round(100*e.aiProb);return e.aiProb<.3?{icon:i.human,text:"Human",className:"ai-badge-human",tooltip:`Human: ${Math.round(100*e.humanProb)}% | AI: ${t}%`}:e.aiProb<.6?{icon:i.uncertain,text:`${t}%`,className:"ai-badge-uncertain",tooltip:`Uncertain - Human: ${Math.round(100*e.humanProb)}% | AI: ${t}%`}:{icon:i.ai,text:`Vibed ${t}%`,className:"ai-badge-ai",tooltip:`Likely AI-generated (vibed) - Human: ${Math.round(100*e.humanProb)}% | AI: ${t}%`}}(t),r=document.createElement("span");r.className=`ai-detector-badge ${n.className}`,r.title=n.tooltip,r.innerHTML=`<span class="ai-badge-icon">${n.icon}</span><span class="ai-badge-text">${n.text}</span>`;const o=e.querySelector('[data-testid="User-Name"]');if(o){(o.querySelector('div[dir="ltr"]')||o).appendChild(r)}}function o(e){if(e.querySelector(".ai-detector-badge"))return;const t=document.createElement("span");t.className="ai-detector-badge ai-badge-limit",t.title="Daily scan limit reached. Add API key for unlimited scans.",t.innerHTML=`<span class="ai-badge-icon">${i.lock}</span><span class="ai-badge-text">Limit</span>`;const n=e.querySelector('[data-testid="User-Name"]');if(n){(n.querySelector('div[dir="ltr"]')||n).appendChild(t)}}function a(e){if(e.querySelector(".ai-detector-badge"))return;const t=document.createElement("span");t.className="ai-detector-badge ai-badge-error",t.title="Failed to analyze tweet",t.innerHTML=`<span class="ai-badge-icon">${i.error}</span><span class="ai-badge-text">Error</span>`;const n=e.querySelector('[data-testid="User-Name"]');if(n){(n.querySelector('div[dir="ltr"]')||n).appendChild(t)}}async function s(s){const d=performance.now(),c=function(e){const t=e.querySelector('a[href*="/status/"]');if(t){const e=t.href.match(/\/status\/(\d+)/);return e?e[1]:null}return`tweet-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}(s);if(!c||t.has(c))return;const l=function(e){const t=e.querySelector('[data-testid="tweetText"]');return t?t.innerText.trim():""}(s);if(!l||l.length<20)return void e(`Skipping tweet ${c} - text too short (${l?.length||0} chars)`);if(e(`Processing tweet ${c}`,{textLength:l.length,textPreview:l.substring(0,50)+"..."}),t.add(c),n)return void o(s);const u=function(e){if(e.querySelector(".ai-detector-badge"))return null;const t=document.createElement("span");t.className="ai-detector-badge ai-badge-loading",t.innerHTML=`<span class="ai-badge-icon ai-badge-spin">${i.loading}</span><span class="ai-badge-text">...</span>`;const n=e.querySelector('[data-testid="User-Name"]');if(n)return(n.querySelector('div[dir="ltr"]')||n).appendChild(t),t;return null}(s);try{e(`Sending message to background for tweet ${c}...`);const t=performance.now(),i=await chrome.runtime.sendMessage({type:"DETECT_AI",text:l,tweetId:c});if(e(`Background response received in ${(performance.now()-t).toFixed(0)}ms`,i),u&&u.remove(),i.limitReached)return n=!0,o(s),void function(){if(document.getElementById("tweetguard-limit-notification"))return;const e=document.createElement("div");e.id="tweetguard-limit-notification",e.innerHTML='\n      <div style="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: linear-gradient(135deg, #ff9800 0%, #f44336 100%);\n        color: white;\n        padding: 16px 20px;\n        border-radius: 12px;\n        font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n        font-size: 14px;\n        z-index: 10000;\n        box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n        max-width: 300px;\n      ">\n        <div style="font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">\n          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>\n          Daily Scan Limit Reached\n        </div>\n        <div style="font-size: 12px; opacity: 0.9;">\n          You\'ve used all 50 free scans today. Add an API key in the extension popup for unlimited scans.\n        </div>\n        <button id="tweetguard-dismiss" style="\n          margin-top: 12px;\n          padding: 8px 16px;\n          background: rgba(255,255,255,0.2);\n          border: none;\n          border-radius: 6px;\n          color: white;\n          font-size: 12px;\n          cursor: pointer;\n        ">Dismiss</button>\n      </div>\n    ',document.body.appendChild(e),document.getElementById("tweetguard-dismiss").addEventListener("click",()=>{e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},1e4)}();if(i.success){r(s,i);e(`Tweet ${c} processed successfully in ${(performance.now()-d).toFixed(0)}ms - AI: ${(100*i.aiProb).toFixed(1)}%`)}else a(s),e(`Tweet ${c} failed - no success`)}catch(t){e(`Error processing tweet ${c} after ${(performance.now()-d).toFixed(0)}ms: ${t.message}`),u&&u.remove(),a(s)}}const d=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&s(e.target)})},{rootMargin:"200px",threshold:.1});function c(){const t=document.querySelectorAll('[data-testid="tweet"]');let n=0;t.forEach(e=>{e.hasAttribute("data-ai-observed")||(e.setAttribute("data-ai-observed","true"),d.observe(e),n++)}),n>0&&e(`Found ${n} new tweets to observe (total on page: ${t.length})`)}const l=new MutationObserver(e=>{clearTimeout(l.timeout),l.timeout=setTimeout(c,100)});async function u(){const t=performance.now();e("Starting initialization...");try{e("Waiting for Twitter DOM...");const n=performance.now();await new Promise(e=>{if(document.querySelector('[data-testid="tweet"]'))return void e();const t=setInterval(()=>{document.querySelector('[data-testid="tweet"]')&&(clearInterval(t),e())},200);setTimeout(()=>{clearInterval(t),e()},3e4)}),e(`Twitter DOM ready in ${(performance.now()-n).toFixed(0)}ms`),e("Starting to observe tweets..."),c(),l.observe(document.body,{childList:!0,subtree:!0});e(`Initialized successfully in ${(performance.now()-t).toFixed(0)}ms`)}catch(t){e(`Initialization failed: ${t.message}`)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}();