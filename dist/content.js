!function(){"use strict";function e(e,t=null){const n=(new Date).toISOString();t?console.log(`[TweetGuard CS ${n}] ${e}`,t):console.log(`[TweetGuard CS ${n}] ${e}`)}const t=new Set;let n=!1;const i={human:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',ai:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></svg>',uncertain:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',lock:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>',loading:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',error:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>',thumbsUp:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>',thumbsDown:'<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/></svg>'};function r(e){const t=e.querySelector('a[href*="/status/"]');if(t){const e=t.href.match(/\/status\/(\d+)/);return e?e[1]:null}return`tweet-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function o(e){const t=e.querySelector('[data-testid="tweetText"]');return t?t.innerText.trim():""}async function a(t,n,i,r,o){try{return(await fetch("https://www.kitha.co/api/model-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tweetId:t,tweetText:n.substring(0,500),aiProb:i,prediction:r,isCorrect:o,timestamp:(new Date).toISOString()})})).ok}catch(t){return e("Failed to send feedback:",t),!1}}function s(e,t){if(e.querySelector(".ai-detector-badge"))return;const n=function(e){const t=Math.round(100*e.aiProb);return e.aiProb<.4?{icon:i.human,text:"Human",className:"ai-badge-human",tooltip:`Human: ${Math.round(100*e.humanProb)}% | AI: ${t}%`,prediction:"human"}:e.aiProb<.7?{icon:i.uncertain,text:`${t}%`,className:"ai-badge-uncertain",tooltip:`Uncertain - Human: ${Math.round(100*e.humanProb)}% | AI: ${t}%`,prediction:"uncertain"}:{icon:i.ai,text:`Vibed ${t}%`,className:"ai-badge-ai",tooltip:`Likely AI-generated (vibed) - Human: ${Math.round(100*e.humanProb)}% | AI: ${t}%`,prediction:"ai"}}(t),s=r(e),c=o(e),d=document.createElement("span");d.className=`ai-detector-badge ${n.className}`,d.title=n.tooltip,d.innerHTML=`\n      <span class="ai-badge-icon">${n.icon}</span>\n      <span class="ai-badge-text">${n.text}</span>\n      <span class="ai-badge-feedback" title="Is this correct?">\n        <button class="ai-feedback-btn ai-feedback-correct" title="Correct">\n          ${i.thumbsUp}\n        </button>\n        <button class="ai-feedback-btn ai-feedback-wrong" title="Wrong">\n          ${i.thumbsDown}\n        </button>\n      </span>\n    `;const l=d.querySelector(".ai-feedback-correct"),u=d.querySelector(".ai-feedback-wrong"),p=d.querySelector(".ai-badge-feedback");l.addEventListener("click",async e=>{e.stopPropagation();await a(s,c,t.aiProb,n.prediction,!0)&&(p.innerHTML='<span class="ai-feedback-thanks">Thanks!</span>')}),u.addEventListener("click",async e=>{e.stopPropagation();await a(s,c,t.aiProb,n.prediction,!1)&&(p.innerHTML='<span class="ai-feedback-thanks">Thanks!</span>')});const h=e.querySelector('[data-testid="User-Name"]');if(h){(h.querySelector('div[dir="ltr"]')||h).appendChild(d)}}function c(e){if(e.querySelector(".ai-detector-badge"))return;const t=document.createElement("span");t.className="ai-detector-badge ai-badge-limit",t.title="Daily scan limit reached. Add API key for unlimited scans.",t.innerHTML=`<span class="ai-badge-icon">${i.lock}</span><span class="ai-badge-text">Limit</span>`;const n=e.querySelector('[data-testid="User-Name"]');if(n){(n.querySelector('div[dir="ltr"]')||n).appendChild(t)}}function d(e){if(e.querySelector(".ai-detector-badge"))return;const t=document.createElement("span");t.className="ai-detector-badge ai-badge-error",t.title="Failed to analyze tweet",t.innerHTML=`<span class="ai-badge-icon">${i.error}</span><span class="ai-badge-text">Error</span>`;const n=e.querySelector('[data-testid="User-Name"]');if(n){(n.querySelector('div[dir="ltr"]')||n).appendChild(t)}}async function l(a){const l=performance.now(),u=r(a);if(!u||t.has(u))return;const p=o(a);if(!p||p.length<20)return void e(`Skipping tweet ${u} - text too short (${p?.length||0} chars)`);if(e(`Processing tweet ${u}`,{textLength:p.length,textPreview:p.substring(0,50)+"..."}),t.add(u),n)return void c(a);const h=function(e){if(e.querySelector(".ai-detector-badge"))return null;const t=document.createElement("span");t.className="ai-detector-badge ai-badge-loading",t.innerHTML=`<span class="ai-badge-icon ai-badge-spin">${i.loading}</span><span class="ai-badge-text">...</span>`;const n=e.querySelector('[data-testid="User-Name"]');if(n)return(n.querySelector('div[dir="ltr"]')||n).appendChild(t),t;return null}(a);try{e(`Sending message to background for tweet ${u}...`);const t=performance.now(),i=await chrome.runtime.sendMessage({type:"DETECT_AI",text:p,tweetId:u});if(e(`Background response received in ${(performance.now()-t).toFixed(0)}ms`,i),h&&h.remove(),i.limitReached)return n=!0,c(a),void function(){if(document.getElementById("tweetguard-limit-notification"))return;const e=document.createElement("div");e.id="tweetguard-limit-notification",e.innerHTML='\n      <div style="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: linear-gradient(135deg, #ff9800 0%, #f44336 100%);\n        color: white;\n        padding: 16px 20px;\n        border-radius: 12px;\n        font-family: -apple-system, BlinkMacSystemFont, sans-serif;\n        font-size: 14px;\n        z-index: 10000;\n        box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n        max-width: 300px;\n      ">\n        <div style="font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">\n          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>\n          Daily Scan Limit Reached\n        </div>\n        <div style="font-size: 12px; opacity: 0.9;">\n          You\'ve used all 50 free scans today. Add an API key in the extension popup for unlimited scans.\n        </div>\n        <button id="tweetguard-dismiss" style="\n          margin-top: 12px;\n          padding: 8px 16px;\n          background: rgba(255,255,255,0.2);\n          border: none;\n          border-radius: 6px;\n          color: white;\n          font-size: 12px;\n          cursor: pointer;\n        ">Dismiss</button>\n      </div>\n    ',document.body.appendChild(e),document.getElementById("tweetguard-dismiss").addEventListener("click",()=>{e.remove()}),setTimeout(()=>{e.parentNode&&e.remove()},1e4)}();if(i.success){s(a,i);e(`Tweet ${u} processed successfully in ${(performance.now()-l).toFixed(0)}ms - AI: ${(100*i.aiProb).toFixed(1)}%`)}else d(a),e(`Tweet ${u} failed - no success`)}catch(t){e(`Error processing tweet ${u} after ${(performance.now()-l).toFixed(0)}ms: ${t.message}`),h&&h.remove(),d(a)}}const u=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&l(e.target)})},{rootMargin:"200px",threshold:.1});function p(){const t=document.querySelectorAll('[data-testid="tweet"]');let n=0;t.forEach(e=>{e.hasAttribute("data-ai-observed")||(e.setAttribute("data-ai-observed","true"),u.observe(e),n++)}),n>0&&e(`Found ${n} new tweets to observe (total on page: ${t.length})`)}const h=new MutationObserver(e=>{clearTimeout(h.timeout),h.timeout=setTimeout(p,100)});async function g(){const t=performance.now();e("Starting initialization...");try{e("Waiting for Twitter DOM...");const n=performance.now();await new Promise(e=>{if(document.querySelector('[data-testid="tweet"]'))return void e();const t=setInterval(()=>{document.querySelector('[data-testid="tweet"]')&&(clearInterval(t),e())},200);setTimeout(()=>{clearInterval(t),e()},3e4)}),e(`Twitter DOM ready in ${(performance.now()-n).toFixed(0)}ms`),e("Starting to observe tweets..."),p(),h.observe(document.body,{childList:!0,subtree:!0});e(`Initialized successfully in ${(performance.now()-t).toFixed(0)}ms`)}catch(t){e(`Initialization failed: ${t.message}`)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()}();